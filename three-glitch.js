THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var r=e.getPixelRatio(),i=Math.floor(e.context.canvas.width/r)||1,n=Math.floor(e.context.canvas.height/r)||1,o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};t=new THREE.WebGLRenderTarget(i,n,o)}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,r,i=!1,n=this.passes.length;for(r=0;n>r;r++)if(t=this.passes[r],t.enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1)}},reset:function(e){if(void 0===e){e=this.renderTarget1.clone();var t=this.renderer.getPixelRatio();e.width=Math.floor(this.renderer.context.canvas.width/t),e.height=Math.floor(this.renderer.context.canvas.height/t)}this.renderTarget1.dispose(),this.renderTarget1=e,this.renderTarget2.dispose(),this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t)}},THREE.RenderPass=function(e,t,r,i,n){this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=void 0!==n?n:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,r,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,r,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:e.defines||{},uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},THREE.ShaderPass.prototype={render:function(e,t,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}},THREE.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(e,t,r,i){var n=e.context;n.colorMask(!1,!1,!1,!1),n.depthMask(!1);var o,a;this.inverse?(o=0,a=1):(o=1,a=0),n.enable(n.STENCIL_TEST),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),n.stencilFunc(n.ALWAYS,o,4294967295),n.clearStencil(a),e.render(this.scene,this.camera,r,this.clear),e.render(this.scene,this.camera,t,this.clear),n.colorMask(!0,!0,!0,!0),n.depthMask(!0),n.stencilFunc(n.EQUAL,1,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(e,t,r,i){var n=e.context;n.disable(n.STENCIL_TEST)}},THREE.DigitalGlitch={uniforms:{tDiffuse:{type:"t",value:null},tDisp:{type:"t",value:null},byp:{type:"i",value:0},amount:{type:"f",value:.08},angle:{type:"f",value:.02},seed:{type:"f",value:.02},seed_x:{type:"f",value:.02},seed_y:{type:"f",value:.02},distortion_x:{type:"f",value:.5},distortion_y:{type:"f",value:.6},col_s:{type:"f",value:.05}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform int byp;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","uniform float distortion_x;","uniform float distortion_y;","uniform float col_s;","varying vec2 vUv;","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","if(byp<1) {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed*seed);","if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {","if(seed_x>0.){","p.y = 1. - (p.y + distortion_y);","}","else {","p.y = distortion_y;","}","}","if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {","if(seed_y>0.){","p.x=distortion_x;","}","else {","p.x = 1. - (p.x + distortion_x);","}","}","p.x+=normal.x*seed_x*(seed/5.);","p.y+=normal.y*seed_y*(seed/5.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","gl_FragColor = gl_FragColor+ snow;","}","else {","gl_FragColor=texture2D (tDiffuse, vUv);","}","}"].join("\n")},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){function e(){if(l===y){var e=new THREE.RenderableObject;return T.push(e),y++,l++,e}return T[l++]}function t(){if(h===x){var e=new THREE.RenderableVertex;return R.push(e),x++,h++,e}return R[h++]}function r(){if(f===H){var e=new THREE.RenderableFace;return g.push(e),H++,f++,e}return g[f++]}function i(){if(E===w){var e=new THREE.RenderableLine;return S.push(e),w++,E++,e}return S[E++]}function n(){if(v===C){var e=new THREE.RenderableSprite;return M.push(e),C++,v++,e}return M[v++]}function o(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function a(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0?!0:0>n&&0>o||0>a&&0>s?!1:(0>n?r=Math.max(r,n/(n-o)):0>o&&(i=Math.min(i,n/(n-o))),0>a?r=Math.max(r,a/(a-s)):0>s&&(i=Math.min(i,a/(a-s))),r>i?!1:(e.lerp(t,r),t.lerp(e,1-i),!0))}var s,l,c,h,d,f,p,E,u,v,m,T=[],y=0,R=[],x=0,g=[],H=0,S=[],w=0,M=[],C=0,b={objects:[],lights:[],elements:[]},z=new THREE.Vector3,P=new THREE.Vector4,V=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),j=new THREE.Box3,F=new Array(3),B=(new Array(4),new THREE.Matrix4),L=new THREE.Matrix4,_=new THREE.Matrix4,D=new THREE.Matrix3,O=new THREE.Frustum,k=new THREE.Vector4,A=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var W=function(){var e=[],n=[],o=null,a=null,s=new THREE.Matrix3,l=function(t){o=t,a=o.material,s.getNormalMatrix(o.matrixWorld),e.length=0,n.length=0},h=function(e){var t=e.position,r=e.positionWorld,i=e.positionScreen;r.copy(t).applyMatrix4(m),i.copy(r).applyMatrix4(L);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},f=function(e,r,i){c=t(),c.position.set(e,r,i),h(c)},E=function(t,r,i){e.push(t,r,i)},u=function(e,t){n.push(e,t)},v=function(e,t,r){return e.visible===!0||t.visible===!0||r.visible===!0?!0:(F[0]=e.positionScreen,F[1]=t.positionScreen,F[2]=r.positionScreen,V.isIntersectionBox(j.setFromPoints(F)))},T=function(e,t,r){return(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},y=function(e,t){var r=R[e],n=R[t];p=i(),p.id=o.id,p.v1.copy(r),p.v2.copy(n),p.z=(r.positionScreen.z+n.positionScreen.z)/2,p.renderOrder=o.renderOrder,p.material=o.material,b.elements.push(p)},x=function(t,i,l){var c=R[t],h=R[i],f=R[l];if(v(c,h,f)!==!1&&(a.side===THREE.DoubleSide||T(c,h,f)===!0)){d=r(),d.id=o.id,d.v1.copy(c),d.v2.copy(h),d.v3.copy(f),d.z=(c.positionScreen.z+h.positionScreen.z+f.positionScreen.z)/3,d.renderOrder=o.renderOrder,d.normalModel.fromArray(e,3*t),d.normalModel.applyMatrix3(s).normalize();for(var p=0;3>p;p++){var E=d.vertexNormalsModel[p];E.fromArray(e,3*arguments[p]),E.applyMatrix3(s).normalize();var u=d.uvs[p];u.fromArray(n,2*arguments[p])}d.vertexNormalsLength=3,d.material=o.material,b.elements.push(d)}};return{setObject:l,projectVertex:h,checkTriangleVisibility:v,checkBackfaceCulling:T,pushVertex:f,pushNormal:E,pushUv:u,pushLine:y,pushTriangle:x}},U=new W;this.projectScene=function(c,T,y,x){f=0,E=0,v=0,b.elements.length=0,c.autoUpdate===!0&&c.updateMatrixWorld(),null===T.parent&&T.updateMatrixWorld(),B.copy(T.matrixWorldInverse.getInverse(T.matrixWorld)),L.multiplyMatrices(T.projectionMatrix,B),O.setFromMatrix(L),l=0,b.objects.length=0,b.lights.length=0,c.traverseVisible(function(t){if(t instanceof THREE.Light)b.lights.push(t);else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite){var r=t.material;if(r.visible===!1)return;(t.frustumCulled===!1||O.intersectsObject(t)===!0)&&(s=e(),s.id=t.id,s.object=t,z.setFromMatrixPosition(t.matrixWorld),z.applyProjection(L),s.z=z.z,s.renderOrder=t.renderOrder,b.objects.push(s))}}),y===!0&&b.objects.sort(o);for(var g=0,H=b.objects.length;H>g;g++){var S=b.objects[g].object,w=S.geometry;if(U.setObject(S),m=S.matrixWorld,h=0,S instanceof THREE.Mesh){if(w instanceof THREE.BufferGeometry){var M=w.attributes,C=w.groups;if(void 0===M.position)continue;for(var V=M.position.array,j=0,F=V.length;F>j;j+=3)U.pushVertex(V[j],V[j+1],V[j+2]);if(void 0!==M.normal)for(var W=M.normal.array,j=0,F=W.length;F>j;j+=3)U.pushNormal(W[j],W[j+1],W[j+2]);if(void 0!==M.uv)for(var G=M.uv.array,j=0,F=G.length;F>j;j+=2)U.pushUv(G[j],G[j+1]);if(null!==w.index){var N=w.index.array;if(C.length>0)for(var g=0;g<C.length;g++)for(var I=C[g],j=I.start,F=I.start+I.count;F>j;j+=3)U.pushTriangle(N[j],N[j+1],N[j+2]);else for(var j=0,F=N.length;F>j;j+=3)U.pushTriangle(N[j],N[j+1],N[j+2])}else for(var j=0,F=V.length/3;F>j;j+=3)U.pushTriangle(j,j+1,j+2)}else if(w instanceof THREE.Geometry){var q=w.vertices,X=w.faces,K=w.faceVertexUvs[0];D.getNormalMatrix(m);for(var Q=S.material,J=Q instanceof THREE.MeshFaceMaterial,Y=J===!0?S.material:null,Z=0,$=q.length;$>Z;Z++){var ee=q[Z];if(z.copy(ee),Q.morphTargets===!0)for(var te=w.morphTargets,re=S.morphTargetInfluences,ie=0,ne=te.length;ne>ie;ie++){var oe=re[ie];if(0!==oe){var ae=te[ie],se=ae.vertices[Z];z.x+=(se.x-ee.x)*oe,z.y+=(se.y-ee.y)*oe,z.z+=(se.z-ee.z)*oe}}U.pushVertex(z.x,z.y,z.z)}for(var le=0,ce=X.length;ce>le;le++){var he=X[le];if(Q=J===!0?Y.materials[he.materialIndex]:S.material,void 0!==Q){var de=Q.side,fe=R[he.a],pe=R[he.b],Ee=R[he.c];if(U.checkTriangleVisibility(fe,pe,Ee)!==!1){var ue=U.checkBackfaceCulling(fe,pe,Ee);if(de!==THREE.DoubleSide){if(de===THREE.FrontSide&&ue===!1)continue;if(de===THREE.BackSide&&ue===!0)continue}d=r(),d.id=S.id,d.v1.copy(fe),d.v2.copy(pe),d.v3.copy(Ee),d.normalModel.copy(he.normal),ue!==!1||de!==THREE.BackSide&&de!==THREE.DoubleSide||d.normalModel.negate(),d.normalModel.applyMatrix3(D).normalize();for(var ve=he.vertexNormals,me=0,Te=Math.min(ve.length,3);Te>me;me++){var ye=d.vertexNormalsModel[me];ye.copy(ve[me]),ue!==!1||de!==THREE.BackSide&&de!==THREE.DoubleSide||ye.negate(),ye.applyMatrix3(D).normalize()}d.vertexNormalsLength=ve.length;var Re=K[le];if(void 0!==Re)for(var xe=0;3>xe;xe++)d.uvs[xe].copy(Re[xe]);d.color=he.color,d.material=Q,d.z=(fe.positionScreen.z+pe.positionScreen.z+Ee.positionScreen.z)/3,d.renderOrder=S.renderOrder,b.elements.push(d)}}}}}else if(S instanceof THREE.Line){if(w instanceof THREE.BufferGeometry){var M=w.attributes;if(void 0!==M.position){for(var V=M.position.array,j=0,F=V.length;F>j;j+=3)U.pushVertex(V[j],V[j+1],V[j+2]);if(null!==w.index)for(var N=w.index.array,j=0,F=N.length;F>j;j+=2)U.pushLine(N[j],N[j+1]);else for(var ge=S instanceof THREE.LineSegments?2:1,j=0,F=V.length/3-1;F>j;j+=ge)U.pushLine(j,j+1)}}else if(w instanceof THREE.Geometry){_.multiplyMatrices(L,m);var q=S.geometry.vertices;if(0===q.length)continue;fe=t(),fe.positionScreen.copy(q[0]).applyMatrix4(_);for(var ge=S instanceof THREE.LineSegments?2:1,Z=1,$=q.length;$>Z;Z++)fe=t(),fe.positionScreen.copy(q[Z]).applyMatrix4(_),(Z+1)%ge>0||(pe=R[h-2],k.copy(fe.positionScreen),A.copy(pe.positionScreen),a(k,A)===!0&&(k.multiplyScalar(1/k.w),A.multiplyScalar(1/A.w),p=i(),p.id=S.id,p.v1.positionScreen.copy(k),p.v2.positionScreen.copy(A),p.z=Math.max(k.z,A.z),p.renderOrder=S.renderOrder,p.material=S.material,S.material.vertexColors===THREE.VertexColors&&(p.vertexColors[0].copy(S.geometry.colors[Z]),p.vertexColors[1].copy(S.geometry.colors[Z-1])),b.elements.push(p)))}}else if(S instanceof THREE.Sprite){P.set(m.elements[12],m.elements[13],m.elements[14],1),P.applyMatrix4(L);var He=1/P.w;P.z*=He,P.z>=-1&&P.z<=1&&(u=n(),u.id=S.id,u.x=P.x*He,u.y=P.y*He,u.z=P.z,u.renderOrder=S.renderOrder,u.object=S,u.rotation=S.rotation,u.scale.x=S.scale.x*Math.abs(u.x-(P.x+T.projectionMatrix.elements[0])/(P.w+T.projectionMatrix.elements[12])),u.scale.y=S.scale.y*Math.abs(u.y-(P.y+T.projectionMatrix.elements[5])/(P.w+T.projectionMatrix.elements[13])),u.material=S.material,b.elements.push(u))}}return x===!0&&b.elements.sort(o),b}},THREE.GlitchPass=function(e){void 0===THREE.DigitalGlitch&&console.error("THREE.GlitchPass relies on THREE.DigitalGlitch");var t=THREE.DigitalGlitch;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),void 0==e&&(e=64),this.uniforms.tDisp.value=this.generateHeightmap(e),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad),this.goWild=!1,this.curF=0,this.generateTrigger()},THREE.GlitchPass.prototype={render:function(e,t,r,i){this.uniforms.tDiffuse.value=r,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=THREE.Math.randFloat(-1,1),this.uniforms.seed_y.value=THREE.Math.randFloat(-1,1),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=THREE.Math.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=THREE.Math.randFloat(0,1),this.uniforms.distortion_y.value=THREE.Math.randFloat(0,1),this.uniforms.seed_x.value=THREE.Math.randFloat(-.3,.3),this.uniforms.seed_y.value=THREE.Math.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,!1)},generateTrigger:function(){this.randX=THREE.Math.randInt(120,240)},generateHeightmap:function(e){for(var t=new Float32Array(e*e*3),r=e*e,i=0;r>i;i++){var n=THREE.Math.randFloat(0,1);t[3*i+0]=n,t[3*i+1]=n,t[3*i+2]=n}var o=new THREE.DataTexture(t,e,e,THREE.RGBFormat,THREE.FloatType);return o.needsUpdate=!0,o}},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){me.setRGB(0,0,0),Te.setRGB(0,0,0),ye.setRGB(0,0,0);for(var e=0,t=g.length;t>e;e++){var r=g[e],i=r.color;r instanceof THREE.AmbientLight?me.add(i):r instanceof THREE.DirectionalLight?Te.add(i):r instanceof THREE.PointLight&&ye.add(i)}}function r(e,t,r){for(var i=0,n=g.length;n>i;i++){var o=g[i];if(fe.copy(o.color),o instanceof THREE.DirectionalLight){var a=Re.setFromMatrixPosition(o.matrixWorld).normalize(),s=t.dot(a);if(0>=s)continue;s*=o.intensity,r.add(fe.multiplyScalar(s))}else if(o instanceof THREE.PointLight){var a=Re.setFromMatrixPosition(o.matrixWorld),s=t.dot(Re.subVectors(a,e).normalize());if(0>=s)continue;if(s*=0==o.distance?1:1-Math.min(e.distanceTo(a)/o.distance,1),0==s)continue;s*=o.intensity,r.add(fe.multiplyScalar(s))}}}function i(e,t,r){f(r.opacity),p(r.blending);var i=t.scale.x*I,n=t.scale.y*q,o=.5*Math.sqrt(i*i+n*n);if(ve.min.set(e.x-o,e.y-o),ve.max.set(e.x+o,e.y+o),r instanceof THREE.SpriteMaterial){var a=r.map;if(null!==a){var s=pe[a.id];if((void 0===s||s.version!==a.version)&&(s=c(a),pe[a.id]=s),void 0!==s.canvas){T(s.canvas);var l=a.image,h=l.width*a.offset.x,d=l.height*a.offset.y,E=l.width*a.repeat.x,u=l.height*a.repeat.y,v=i/E,y=n/u;Z.save(),Z.translate(e.x,e.y),0!==r.rotation&&Z.rotate(r.rotation),Z.translate(-i/2,-n/2),Z.scale(v,y),Z.translate(-h,-d),Z.fillRect(h,d,E,u),Z.restore()}}else T(r.color.getStyle()),Z.save(),Z.translate(e.x,e.y),0!==r.rotation&&Z.rotate(r.rotation),Z.scale(i,-n),Z.fillRect(-.5,-.5,1,1),Z.restore()}else r instanceof THREE.SpriteCanvasMaterial&&(m(r.color.getStyle()),T(r.color.getStyle()),Z.save(),Z.translate(e.x,e.y),0!==r.rotation&&Z.rotate(r.rotation),Z.scale(i,n),r.program(Z),Z.restore())}function n(e,t,r,i){if(f(i.opacity),p(i.blending),Z.beginPath(),Z.moveTo(e.positionScreen.x,e.positionScreen.y),Z.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof THREE.LineBasicMaterial){if(E(i.linewidth),u(i.linecap),v(i.linejoin),i.vertexColors!==THREE.VertexColors)m(i.color.getStyle());else{var n=r.vertexColors[0].getStyle(),o=r.vertexColors[1].getStyle();if(n===o)m(n);else{try{var a=Z.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,n),a.addColorStop(1,o)}catch(s){a=n}m(a)}}Z.stroke(),ve.expandByScalar(2*i.linewidth)}else i instanceof THREE.LineDashedMaterial&&(E(i.linewidth),u(i.linecap),v(i.linejoin),m(i.color.getStyle()),y([i.dashSize,i.gapSize]),Z.stroke(),ve.expandByScalar(2*i.linewidth),y([]))}function o(e,t,i,n,o,c,d,E){if(A.info.render.vertices+=3,A.info.render.faces++,f(E.opacity),p(E.blending),C=e.positionScreen.x,b=e.positionScreen.y,z=t.positionScreen.x,P=t.positionScreen.y,V=i.positionScreen.x,j=i.positionScreen.y,a(C,b,z,P,V,j),(E instanceof THREE.MeshLambertMaterial||E instanceof THREE.MeshPhongMaterial)&&null===E.map)he.copy(E.color),de.copy(E.emissive),E.vertexColors===THREE.FaceColors&&he.multiply(d.color),ce.copy(me),xe.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),r(xe,d.normalModel,ce),ce.multiply(he).add(de),E.wireframe===!0?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):l(ce);else if(E instanceof THREE.MeshBasicMaterial||E instanceof THREE.MeshLambertMaterial||E instanceof THREE.MeshPhongMaterial)if(null!==E.map){var u=E.map.mapping;u===THREE.UVMapping&&(F=d.uvs,h(C,b,z,P,V,j,F[n].x,F[n].y,F[o].x,F[o].y,F[c].x,F[c].y,E.map))}else null!==E.envMap?E.envMap.mapping===THREE.SphericalReflectionMapping&&(ge.copy(d.vertexNormalsModel[n]).applyMatrix3(He),B=.5*ge.x+.5,L=.5*ge.y+.5,ge.copy(d.vertexNormalsModel[o]).applyMatrix3(He),_=.5*ge.x+.5,D=.5*ge.y+.5,ge.copy(d.vertexNormalsModel[c]).applyMatrix3(He),O=.5*ge.x+.5,k=.5*ge.y+.5,h(C,b,z,P,V,j,B,L,_,D,O,k,E.envMap)):(ce.copy(E.color),E.vertexColors===THREE.FaceColors&&ce.multiply(d.color),E.wireframe===!0?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):l(ce));else E instanceof THREE.MeshNormalMaterial?(ge.copy(d.normalModel).applyMatrix3(He),ce.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),E.wireframe===!0?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):l(ce)):(ce.setRGB(1,1,1),E.wireframe===!0?s(ce,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):l(ce))}function a(e,t,r,i,n,o){Z.beginPath(),Z.moveTo(e,t),Z.lineTo(r,i),Z.lineTo(n,o),Z.closePath()}function s(e,t,r,i){E(t),u(r),v(i),m(e.getStyle()),Z.stroke(),ve.expandByScalar(2*t)}function l(e){T(e.getStyle()),Z.fill()}function c(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image,r=document.createElement("canvas");r.width=t.width,r.height=t.height;var i=r.getContext("2d");i.setTransform(1,0,0,-1,0,t.height),i.drawImage(t,0,0);var n=e.wrapS===THREE.RepeatWrapping,o=e.wrapT===THREE.RepeatWrapping,a="no-repeat";return n===!0&&o===!0?a="repeat":n===!0?a="repeat-x":o===!0&&(a="repeat-y"),{canvas:Z.createPattern(r,a),version:e.version}}function h(e,t,r,i,n,o,a,s,l,h,d,f,p){var E=pe[p.id];if((void 0===E||E.version!==p.version)&&(E=c(p),pe[p.id]=E),void 0===E.canvas)return T("rgba( 0, 0, 0, 1)"),void Z.fill();T(E.canvas);var u,v,m,y,R,x,g,H,S=p.offset.x/p.repeat.x,w=p.offset.y/p.repeat.y,M=p.image.width*p.repeat.x,C=p.image.height*p.repeat.y;a=(a+S)*M,s=(s+w)*C,l=(l+S)*M,h=(h+w)*C,d=(d+S)*M,f=(f+w)*C,r-=e,i-=t,n-=e,o-=t,l-=a,h-=s,d-=a,f-=s,g=l*f-d*h,0!==g&&(H=1/g,u=(f*r-h*n)*H,v=(f*i-h*o)*H,m=(l*n-d*r)*H,y=(l*o-d*i)*H,R=e-u*a-m*s,x=t-v*a-y*s,Z.save(),Z.transform(u,v,m,y,R,x),Z.fill(),Z.restore())}function d(e,t,r){var i,n=t.x-e.x,o=t.y-e.y,a=n*n+o*o;0!==a&&(i=r/Math.sqrt(a),n*=i,o*=i,t.x+=n,t.y+=o,e.x-=n,e.y-=o)}function f(e){te!==e&&(Z.globalAlpha=e,te=e)}function p(e){re!==e&&(e===THREE.NormalBlending?Z.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?Z.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(Z.globalCompositeOperation="darker"),re=e)}function E(e){oe!==e&&(Z.lineWidth=e,oe=e)}function u(e){ae!==e&&(Z.lineCap=e,ae=e)}function v(e){se!==e&&(Z.lineJoin=e,se=e)}function m(e){ie!==e&&(Z.strokeStyle=e,ie=e)}function T(e){ne!==e&&(Z.fillStyle=e,ne=e)}function y(e){le.length!==e.length&&(Z.setLineDash(e),le=e)}console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var R,x,g,H,S,w,M,C,b,z,P,V,j,F,B,L,_,D,O,k,A=this,W=new THREE.Projector,U=void 0!==e.canvas?e.canvas:document.createElement("canvas"),G=U.width,N=U.height,I=Math.floor(G/2),q=Math.floor(N/2),X=0,K=0,Q=G,J=N,Y=1,Z=U.getContext("2d",{alpha:e.alpha===!0}),$=new THREE.Color(0),ee=e.alpha===!0?0:1,te=1,re=0,ie=null,ne=null,oe=null,ae=null,se=null,le=[],ce=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),he=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),de=new THREE.Color,fe=new THREE.Color,pe={},Ee=new THREE.Box2,ue=new THREE.Box2,ve=new THREE.Box2,me=new THREE.Color,Te=new THREE.Color,ye=new THREE.Color,Re=new THREE.Vector3,xe=new THREE.Vector3,ge=new THREE.Vector3,He=new THREE.Matrix3;void 0===Z.setLineDash&&(Z.setLineDash=function(){}),this.domElement=U,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e)},this.setSize=function(e,t,r){G=e*Y,N=t*Y,U.width=G,U.height=N,I=Math.floor(G/2),q=Math.floor(N/2),r!==!1&&(U.style.width=e+"px",U.style.height=t+"px"),Ee.min.set(-I,-q),Ee.max.set(I,q),ue.min.set(-I,-q),ue.max.set(I,q),te=1,re=0,ie=null,ne=null,oe=null,ae=null,se=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,r,i){X=e*Y,K=t*Y,Q=r*Y,J=i*Y},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){$.set(e),ee=void 0!==t?t:1,ue.min.set(-I,-q),ue.max.set(I,q)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return $},this.getClearAlpha=function(){return ee},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ue.empty()===!1&&(ue.intersect(Ee),ue.expandByScalar(2),ue.min.x=ue.min.x+I,ue.min.y=-ue.min.y+q,ue.max.x=ue.max.x+I,ue.max.y=-ue.max.y+q,1>ee&&Z.clearRect(0|ue.min.x,0|ue.max.y,ue.max.x-ue.min.x|0,ue.min.y-ue.max.y|0),ee>0&&(p(THREE.NormalBlending),f(1),T("rgba("+Math.floor(255*$.r)+","+Math.floor(255*$.g)+","+Math.floor(255*$.b)+","+ee+")"),Z.fillRect(0|ue.min.x,0|ue.max.y,ue.max.x-ue.min.x|0,ue.min.y-ue.max.y|0)),ue.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,r){if(r instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),A.info.render.vertices=0,A.info.render.faces=0,Z.setTransform(Q/G,0,0,-J/N,X,N-K),Z.translate(I,q),R=W.projectScene(e,r,this.sortObjects,this.sortElements),x=R.elements,g=R.lights,H=r,He.getNormalMatrix(r.matrixWorldInverse),t();for(var a=0,s=x.length;s>a;a++){var l=x[a],c=l.material;if(void 0!==c&&0!==c.opacity){if(ve.makeEmpty(),l instanceof THREE.RenderableSprite)S=l,S.x*=I,S.y*=q,i(S,l,c);else if(l instanceof THREE.RenderableLine)S=l.v1,w=l.v2,S.positionScreen.x*=I,S.positionScreen.y*=q,w.positionScreen.x*=I,w.positionScreen.y*=q,ve.setFromPoints([S.positionScreen,w.positionScreen]),Ee.isIntersectionBox(ve)===!0&&n(S,w,l,c);else if(l instanceof THREE.RenderableFace){if(S=l.v1,w=l.v2,M=l.v3,S.positionScreen.z<-1||S.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;if(M.positionScreen.z<-1||M.positionScreen.z>1)continue;S.positionScreen.x*=I,S.positionScreen.y*=q,w.positionScreen.x*=I,w.positionScreen.y*=q,M.positionScreen.x*=I,M.positionScreen.y*=q,c.overdraw>0&&(d(S.positionScreen,w.positionScreen,c.overdraw),d(w.positionScreen,M.positionScreen,c.overdraw),d(M.positionScreen,S.positionScreen,c.overdraw)),ve.setFromPoints([S.positionScreen,w.positionScreen,M.positionScreen]),Ee.isIntersectionBox(ve)===!0&&o(S,w,M,0,1,2,l,c)}ue.union(ve)}}Z.setTransform(1,0,0,1,0,0)}};